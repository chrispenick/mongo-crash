<h1 id="mongodb-fundamentals">MongoDB Fundamentals</h1>
<h2 id="overview-and-objectives">Overview and Objectives</h2>
<p>This course introduces students to MongoDB through hands-on exercises
using real-world datasets. By the end of this course, students will
confidently create, query, and manipulate MongoDB databases while
understanding when and why to choose NoSQL solutions over traditional
relational databases.</p>
<p><strong>Prerequisites</strong>: Basic programming knowledge in
JavaScript or Python, familiarity with JSON format, and understanding of
database concepts.</p>
<p><strong>Learning Outcomes</strong>: Students will demonstrate
proficiency in MongoDB operations, design effective document schemas,
integrate MongoDB with web applications, and implement performance
optimization strategies.</p>
<hr />
<h2 id="session-1-mongodb-foundations-and-environment-setup">Session 1:
MongoDB Foundations and Environment Setup</h2>
<h3 id="theoretical-foundation">Theoretical Foundation</h3>
<p>Understanding MongoDB begins with recognizing how document databases
fundamentally differ from the relational model you may already know.
Where SQL databases force data into rigid table structures with
predefined columns, MongoDB stores information as flexible documents
that can have different structures within the same collection.</p>
<p>Think of this difference like comparing a traditional filing cabinet
with labeled folders for specific document types versus a modern digital
folder system where each file can have its own format and metadata. This
flexibility becomes powerful when dealing with real-world data that
doesn’t fit neatly into predetermined categories.</p>
<p>MongoDB organizes data hierarchically: databases contain collections,
collections contain documents, and documents contain fields with values.
Unlike SQL tables where every row must have the same columns, MongoDB
documents within a collection can have completely different field
structures. This schema flexibility allows applications to evolve
without complex database migrations.</p>
<p><strong>Key concepts that will guide our hands-on work:</strong> -
<strong>BSON (Binary JSON)</strong>: MongoDB’s internal storage format
that extends JSON with additional data types like ObjectId, Date, and
Binary data - <strong>Collections</strong>: Analogous to SQL tables but
without enforced schemas - <strong>Documents</strong>: Individual
records stored as BSON, similar to JSON objects -
<strong>Fields</strong>: Key-value pairs within documents, equivalent to
columns in SQL - <strong>Embedded Documents</strong>: Nested objects
within documents that model one-to-one or one-to-few relationships -
<strong>References</strong>: Links between documents using ObjectId
values, similar to foreign keys in SQL</p>
<h3 id="environment-setup-lab">Environment Setup Lab</h3>
<p><strong>Lab 1.1: MongoDB Installation and Connection</strong></p>
<p>Choose your installation path based on your development preferences
and system requirements.</p>
<p><strong>Option A: Local Installation</strong> Follow the installation
steps for your operating system from our previous guide. After
installation, verify your setup by opening a terminal and connecting to
MongoDB using the mongo shell.</p>
<p>Start MongoDB service and connect:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start MongoDB (varies by OS)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start mongod  <span class="co"># Linux</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> services start mongodb-community  <span class="co"># macOS  </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">net</span> start MongoDB  <span class="co"># Windows</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect using the mongo shell</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">mongosh</span></span></code></pre></div>
<p><strong>Option B: MongoDB Atlas (Cloud)</strong> Create a free
MongoDB Atlas account if you prefer cloud-based development. This option
eliminates local setup complexity and provides a production-like
environment from the start.</p>
<p>Navigate to cloud.mongodb.com, create an account, and set up a free
M0 Sandbox cluster. Configure network access to allow connections from
your current IP address, then create a database user with read/write
permissions.</p>
<p>Your connection string will look like:</p>
<pre><code>mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/test</code></pre>
<p><strong>Lab 1.2: Loading Sample Databases</strong></p>
<p>MongoDB provides several sample databases that contain realistic data
for learning purposes. We’ll use these throughout our exercises to work
with meaningful datasets rather than artificial examples.</p>
<p>For Atlas users, sample datasets can be loaded directly from the
Atlas interface. Click “Browse Collections” in your cluster, then “Load
Sample Dataset” button.</p>
<p>For local installations, download and import the sample
databases:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download sample data (this may take several minutes)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://atlas-education.s3.amazonaws.com/sampledata.archive</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import using mongorestore</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">mongorestore</span> <span class="at">--archive</span><span class="op">=</span>sampledata.archive <span class="at">--gzip</span></span></code></pre></div>
<p><strong>Verification Exercise:</strong> Connect to your MongoDB
instance and explore the available databases:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// List all databases</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>show dbs</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Switch to the sample movie database</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">// List collections in this database</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>show collections</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Count documents in the movies collection</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">countDocuments</span>()</span></code></pre></div>
<p>You should see several sample databases including sample_mflix,
sample_restaurants, sample_supplies, and others. Each contains
real-world data that will make our exercises more engaging and
relevant.</p>
<h3 id="document-structure-exploration">Document Structure
Exploration</h3>
<p><strong>Lab 1.3: Understanding Document Structure</strong></p>
<p>Let’s examine real documents to understand MongoDB’s flexible schema
approach. We’ll start with the movie database because it contains rich,
varied data structures that demonstrate MongoDB’s capabilities.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Switch to the movies database</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Find one movie document to examine its structure</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">findOne</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Find a movie with a specific structure to see the variation</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">findOne</span>({<span class="dt">title</span><span class="op">:</span> <span class="st">&quot;The Princess Bride&quot;</span>})</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Examine the different data types and structures</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">findOne</span>({}<span class="op">,</span> {<span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">genres</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">cast</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">imdb</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div>
<p>Notice how each movie document contains different fields and data
types. Some movies have detailed IMDB ratings while others don’t. Some
have extensive cast lists while others are minimal. This flexibility
allows the database to accommodate incomplete or varying data without
forcing null values into every document.</p>
<p><strong>Thinking Exercise</strong>: Compare this to how you would
model movie data in a traditional SQL database. Consider how you would
handle the varying cast sizes, multiple genres per movie, and optional
rating information. What challenges would you face with schema changes
as new data requirements emerge?</p>
<p><strong>Lab 1.4: Exploring Different Collection
Structures</strong></p>
<p>Let’s examine how different types of data are structured across
various collections:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Examine restaurant data structure</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>use sample_restaurants</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">findOne</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Look at the address embedding pattern</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">findOne</span>({}<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">address</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">grades</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Examine supply store data</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>use sample_supplies</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">sales</span><span class="op">.</span><span class="fu">findOne</span>()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Notice the complex nested structure of items array</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">sales</span><span class="op">.</span><span class="fu">findOne</span>({}<span class="op">,</span> {<span class="dt">saleDate</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">items</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">customer</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div>
<p>Each collection demonstrates different document design patterns.
Restaurants embed address information directly in each document because
addresses are tightly coupled with restaurant identity. The sales
collection shows an array of embedded item documents, representing a
one-to-many relationship within a single document.</p>
<p><strong>Analysis Questions for Discussion:</strong> 1. Why might the
restaurant addresses be embedded rather than referenced in a separate
collection? 2. How does the sales document structure handle the shopping
cart concept? 3. What are the trade-offs between embedding versus
referencing in each case?</p>
<hr />
<h2 id="session-2-essential-crud-operations-with-real-data">Session 2:
Essential CRUD Operations with Real Data</h2>
<h3 id="querying-fundamentals">Querying Fundamentals</h3>
<p><strong>Lab 2.1: Basic Query Operations</strong></p>
<p>Effective querying starts with understanding how MongoDB matches
documents based on field values and conditions. We’ll practice with the
movie database to build our query skills progressively.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Basic equality queries</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">year</span><span class="op">:</span> <span class="dv">2000</span>})</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">rated</span><span class="op">:</span> <span class="st">&quot;PG&quot;</span>})</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Multiple conditions (implicit AND)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">year</span><span class="op">:</span> <span class="dv">2000</span><span class="op">,</span> <span class="dt">rated</span><span class="op">:</span> <span class="st">&quot;PG&quot;</span>})</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Using comparison operators</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2010</span>}})</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">runtime</span><span class="op">:</span> {<span class="dt">$lt</span><span class="op">:</span> <span class="dv">90</span>}})</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Combining multiple operators</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2010</span><span class="op">,</span> <span class="dt">$lte</span><span class="op">:</span> <span class="dv">2015</span>}<span class="op">,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">runtime</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">90</span><span class="op">,</span> <span class="dt">$lte</span><span class="op">:</span> <span class="dv">120</span>}</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Lab 2.2: Array and Embedded Document Queries</strong></p>
<p>MongoDB’s real power emerges when querying complex nested structures.
Arrays and embedded documents require special consideration but provide
enormous flexibility.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Querying arrays - finding movies with specific genres</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Comedy&quot;</span>})</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Finding movies with multiple specific genres</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">genres</span><span class="op">:</span> {<span class="dt">$all</span><span class="op">:</span> [<span class="st">&quot;Comedy&quot;</span><span class="op">,</span> <span class="st">&quot;Romance&quot;</span>]}})</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Finding movies with any of several genres</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">genres</span><span class="op">:</span> {<span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;Horror&quot;</span><span class="op">,</span> <span class="st">&quot;Thriller&quot;</span>]}})</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Querying embedded documents - IMDB ratings</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="fl">8.5</span>}})</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Complex embedded queries</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="fl">8.0</span>}<span class="op">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.votes&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">100000</span>}</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Array element queries with conditions</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;cast.0&quot;</span><span class="op">:</span> <span class="st">&quot;Tom Hanks&quot;</span>  <span class="co">// Tom Hanks is the first cast member</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Practical Exercise</strong>: Find all comedy movies from the
1990s with an IMDB rating above 7.0 that star specific actors. This
exercise combines multiple query concepts and simulates real-world
search requirements.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Comedy&quot;</span><span class="op">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">1990</span><span class="op">,</span> <span class="dt">$lt</span><span class="op">:</span> <span class="dv">2000</span>}<span class="op">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gt</span><span class="op">:</span> <span class="fl">7.0</span>}<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cast</span><span class="op">:</span> {<span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;Robin Williams&quot;</span><span class="op">,</span> <span class="st">&quot;Jim Carrey&quot;</span><span class="op">,</span> <span class="st">&quot;Adam Sandler&quot;</span>]}</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="data-projection-and-sorting">Data Projection and Sorting</h3>
<p><strong>Lab 2.3: Controlling Query Results</strong></p>
<p>Real applications rarely need entire documents returned from queries.
Projection allows you to specify exactly which fields to return,
improving performance and reducing network traffic.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Basic projection - only return specific fields</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Action&quot;</span>}<span class="op">,</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">runtime</span><span class="op">:</span> <span class="dv">1</span>}</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Exclude specific fields (return everything except specified fields)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">year</span><span class="op">:</span> <span class="dv">2010</span>}<span class="op">,</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">plot</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">fullplot</span><span class="op">:</span> <span class="dv">0</span>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Embedded document projection</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    {<span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="fl">8.0</span>}}<span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;imdb.votes&quot;</span><span class="op">:</span> <span class="dv">1</span>}</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Array element projection</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Drama&quot;</span>}<span class="op">,</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;cast&quot;</span><span class="op">:</span> {<span class="dt">$slice</span><span class="op">:</span> <span class="dv">3</span>}}  <span class="co">// Only first 3 cast members</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Lab 2.4: Sorting and Limiting Results</strong></p>
<p>Production applications must handle large datasets efficiently.
Sorting and limiting results prevents overwhelming users and improves
application performance.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Sort by single field</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Action&quot;</span>})<span class="op">.</span><span class="fu">sort</span>({<span class="dt">year</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Sort by multiple fields</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Comedy&quot;</span>})<span class="op">.</span><span class="fu">sort</span>({<span class="dt">year</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Combine sorting with limiting</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Drama&quot;</span>})<span class="op">.</span><span class="fu">sort</span>({<span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Skip and limit for pagination</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Comedy&quot;</span>})<span class="op">.</span><span class="fu">sort</span>({<span class="dt">year</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})<span class="op">.</span><span class="fu">skip</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Complex query with all elements</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Action&quot;</span><span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span>}<span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span>}</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>)<span class="op">.</span><span class="fu">sort</span>({<span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})<span class="op">.</span><span class="fu">limit</span>(<span class="dv">5</span>)</span></code></pre></div>
<h3 id="creating-and-modifying-data">Creating and Modifying Data</h3>
<p><strong>Lab 2.5: Document Insertion Strategies</strong></p>
<p>Understanding insertion patterns helps you design applications that
scale efficiently. We’ll practice with the restaurant dataset to see
realistic data insertion scenarios.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>use sample_restaurants</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Insert a single new restaurant</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">insertOne</span>({</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Tech Café&quot;</span><span class="op">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cuisine</span><span class="op">:</span> <span class="st">&quot;Fusion&quot;</span><span class="op">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">borough</span><span class="op">:</span> <span class="st">&quot;Manhattan&quot;</span><span class="op">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">address</span><span class="op">:</span> {</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">building</span><span class="op">:</span> <span class="st">&quot;123&quot;</span><span class="op">,</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">street</span><span class="op">:</span> <span class="st">&quot;Tech Street&quot;</span><span class="op">,</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zipcode</span><span class="op">:</span> <span class="st">&quot;10001&quot;</span><span class="op">,</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">coord</span><span class="op">:</span> [<span class="op">-</span><span class="fl">73.985656</span><span class="op">,</span> <span class="fl">40.748817</span>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">grades</span><span class="op">:</span> [</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">grade</span><span class="op">:</span> <span class="st">&quot;A&quot;</span><span class="op">,</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">score</span><span class="op">:</span> <span class="dv">12</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Insert multiple restaurants efficiently</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">insertMany</span>([</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Code &amp; Coffee&quot;</span><span class="op">,</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cuisine</span><span class="op">:</span> <span class="st">&quot;American&quot;</span><span class="op">,</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">borough</span><span class="op">:</span> <span class="st">&quot;Brooklyn&quot;</span><span class="op">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">address</span><span class="op">:</span> {</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>            <span class="dt">building</span><span class="op">:</span> <span class="st">&quot;456&quot;</span><span class="op">,</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">street</span><span class="op">:</span> <span class="st">&quot;Developer Ave&quot;</span><span class="op">,</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>            <span class="dt">zipcode</span><span class="op">:</span> <span class="st">&quot;11201&quot;</span><span class="op">,</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>            <span class="dt">coord</span><span class="op">:</span> [<span class="op">-</span><span class="fl">73.990593</span><span class="op">,</span> <span class="fl">40.692251</span>]</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">grades</span><span class="op">:</span> []</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Algorithm Bistro&quot;</span><span class="op">,</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">cuisine</span><span class="op">:</span> <span class="st">&quot;French&quot;</span><span class="op">,</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>        <span class="dt">borough</span><span class="op">:</span> <span class="st">&quot;Queens&quot;</span><span class="op">,</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">address</span><span class="op">:</span> {</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">building</span><span class="op">:</span> <span class="st">&quot;789&quot;</span><span class="op">,</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>            <span class="dt">street</span><span class="op">:</span> <span class="st">&quot;Function Way&quot;</span><span class="op">,</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">zipcode</span><span class="op">:</span> <span class="st">&quot;11101&quot;</span><span class="op">,</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>            <span class="dt">coord</span><span class="op">:</span> [<span class="op">-</span><span class="fl">73.949900</span><span class="op">,</span> <span class="fl">40.750580</span>]</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        <span class="dt">grades</span><span class="op">:</span> [</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>                <span class="dt">date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>                <span class="dt">grade</span><span class="op">:</span> <span class="st">&quot;B&quot;</span><span class="op">,</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>                <span class="dt">score</span><span class="op">:</span> <span class="dv">18</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<p><strong>Lab 2.6: Document Updates and Modifications</strong></p>
<p>Update operations in MongoDB provide powerful ways to modify existing
data without replacing entire documents. This efficiency becomes crucial
as your datasets grow.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Update a single document - add a new grade</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">updateOne</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Tech Café&quot;</span>}<span class="op">,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$push</span><span class="op">:</span> {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">grades</span><span class="op">:</span> {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                <span class="dt">date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                <span class="dt">grade</span><span class="op">:</span> <span class="st">&quot;A&quot;</span><span class="op">,</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                <span class="dt">score</span><span class="op">:</span> <span class="dv">8</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Update multiple documents - change cuisine type</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">updateMany</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">cuisine</span><span class="op">:</span> <span class="st">&quot;American&quot;</span>}<span class="op">,</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$set</span><span class="op">:</span> {<span class="dt">cuisine</span><span class="op">:</span> <span class="st">&quot;Contemporary American&quot;</span>}}</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Complex update with multiple operators</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">updateOne</span>(</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Algorithm Bistro&quot;</span>}<span class="op">,</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$set</span><span class="op">:</span> {</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;address.building&quot;</span><span class="op">:</span> <span class="st">&quot;800&quot;</span><span class="op">,</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">lastInspection</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$inc</span><span class="op">:</span> {<span class="dt">inspectionCount</span><span class="op">:</span> <span class="dv">1</span>}</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert operation - insert if not found, update if exists</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">updateOne</span>(</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Data Diner&quot;</span>}<span class="op">,</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$set</span><span class="op">:</span> {</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>            <span class="dt">cuisine</span><span class="op">:</span> <span class="st">&quot;International&quot;</span><span class="op">,</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="dt">borough</span><span class="op">:</span> <span class="st">&quot;Bronx&quot;</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$setOnInsert</span><span class="op">:</span> {</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">address</span><span class="op">:</span> {</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                <span class="dt">building</span><span class="op">:</span> <span class="st">&quot;999&quot;</span><span class="op">,</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                <span class="dt">street</span><span class="op">:</span> <span class="st">&quot;Database Drive&quot;</span><span class="op">,</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                <span class="dt">zipcode</span><span class="op">:</span> <span class="st">&quot;10451&quot;</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>            <span class="dt">grades</span><span class="op">:</span> []</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">upsert</span><span class="op">:</span> <span class="kw">true</span>}</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Practical Challenge</strong>: Create a script that updates
all restaurants in Manhattan to include a new field called
“premiumLocation” set to true, and adds a inspection reminder date 30
days from now. This exercise demonstrates real-world data maintenance
scenarios.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">updateMany</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">borough</span><span class="op">:</span> <span class="st">&quot;Manhattan&quot;</span>}<span class="op">,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$set</span><span class="op">:</span> {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">premiumLocation</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">inspectionReminder</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> <span class="dv">30</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<hr />
<h2 id="session-3-advanced-querying-and-aggregation-framework">Session
3: Advanced Querying and Aggregation Framework</h2>
<h3 id="complex-query-patterns">Complex Query Patterns</h3>
<p><strong>Lab 3.1: Advanced Query Operators</strong></p>
<p>As applications become more sophisticated, simple equality queries
aren’t sufficient. MongoDB provides extensive query operators that
handle complex conditions and data analysis requirements.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Logical operators for complex conditions</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">$or</span><span class="op">:</span> [</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Comedy&quot;</span>}<span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Romance&quot;</span>}</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span>}</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">// NOT operator for exclusions</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">genres</span><span class="op">:</span> {<span class="dt">$not</span><span class="op">:</span> {<span class="dt">$in</span><span class="op">:</span> [<span class="st">&quot;Horror&quot;</span><span class="op">,</span> <span class="st">&quot;Thriller&quot;</span>]}}<span class="op">,</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="fl">7.0</span>}</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Element queries for field existence and types</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">awards</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;awards.wins&quot;</span><span class="op">:</span> {<span class="dt">$type</span><span class="op">:</span> <span class="st">&quot;number&quot;</span><span class="op">,</span> <span class="dt">$gt</span><span class="op">:</span> <span class="dv">5</span>}</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Regular expressions for text pattern matching</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> {<span class="dt">$regex</span><span class="op">:</span> <span class="st">&quot;^The&quot;</span><span class="op">,</span> <span class="dt">$options</span><span class="op">:</span> <span class="st">&quot;i&quot;</span>}  <span class="co">// Titles starting with &quot;The&quot; (case insensitive)</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Array queries with specific conditions</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cast</span><span class="op">:</span> {<span class="dt">$size</span><span class="op">:</span> <span class="dv">1</span>}  <span class="co">// Movies with exactly one cast member</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Lab 3.2: Working with Geospatial Data</strong></p>
<p>The restaurant dataset includes geographical coordinates, allowing us
to explore MongoDB’s geospatial capabilities. This functionality becomes
essential for location-based applications.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>use sample_restaurants</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Find restaurants near a specific location (requires geospatial index)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">createIndex</span>({<span class="st">&quot;address.coord&quot;</span><span class="op">:</span> <span class="st">&quot;2dsphere&quot;</span>})</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Find restaurants within 1000 meters of a point in Manhattan</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;address.coord&quot;</span><span class="op">:</span> {</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$near</span><span class="op">:</span> {</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$geometry</span><span class="op">:</span> {</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                <span class="dt">coordinates</span><span class="op">:</span> [<span class="op">-</span><span class="fl">73.985656</span><span class="op">,</span> <span class="fl">40.748817</span>]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$maxDistance</span><span class="op">:</span> <span class="dv">1000</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Find restaurants within a geographical area</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;address.coord&quot;</span><span class="op">:</span> {</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$geoWithin</span><span class="op">:</span> {</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">$geometry</span><span class="op">:</span> {</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;Polygon&quot;</span><span class="op">,</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                <span class="dt">coordinates</span><span class="op">:</span> [[</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>                    [<span class="op">-</span><span class="fl">74.0</span><span class="op">,</span> <span class="fl">40.7</span>]<span class="op">,</span> [<span class="op">-</span><span class="fl">73.9</span><span class="op">,</span> <span class="fl">40.7</span>]<span class="op">,</span> [<span class="op">-</span><span class="fl">73.9</span><span class="op">,</span> <span class="fl">40.8</span>]<span class="op">,</span> [<span class="op">-</span><span class="fl">74.0</span><span class="op">,</span> <span class="fl">40.8</span>]<span class="op">,</span> [<span class="op">-</span><span class="fl">74.0</span><span class="op">,</span> <span class="fl">40.7</span>]</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>                ]]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="aggregation-pipeline-fundamentals">Aggregation Pipeline
Fundamentals</h3>
<p><strong>Lab 3.3: Introduction to Aggregation</strong></p>
<p>The aggregation framework transforms MongoDB from a simple document
store into a powerful data analysis platform. Think of aggregation
pipelines as assembly lines where documents pass through multiple
stages, each performing specific transformations.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage 1: Match documents (equivalent to WHERE in SQL)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span>}}}</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage 2: Group documents and calculate statistics</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span>}}}<span class="op">,</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$year&quot;</span><span class="op">,</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalMovies</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgRating</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Stage 3: Sort the results</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span>}}}<span class="op">,</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$year&quot;</span><span class="op">,</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalMovies</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgRating</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="dt">year</span><span class="op">:</span> <span class="dv">1</span>}}</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<p><strong>Lab 3.4: Complex Aggregation Scenarios</strong></p>
<p>Real-world data analysis requires sophisticated aggregation pipelines
that combine multiple operations. Let’s analyze movie trends and
patterns using progressively complex pipelines.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Analyze genre popularity over decades</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">genres</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span> <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">1900</span>}}}<span class="op">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$genres&quot;</span>}<span class="op">,</span>  <span class="co">// Separate each genre into its own document</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$addFields</span><span class="op">:</span> {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">decade</span><span class="op">:</span> {<span class="dt">$multiply</span><span class="op">:</span> [{<span class="dt">$floor</span><span class="op">:</span> {<span class="dt">$divide</span><span class="op">:</span> [<span class="st">&quot;$year&quot;</span><span class="op">,</span> <span class="dv">10</span>]}}<span class="op">,</span> <span class="dv">10</span>]}</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> {<span class="dt">genre</span><span class="op">:</span> <span class="st">&quot;$genres&quot;</span><span class="op">,</span> <span class="dt">decade</span><span class="op">:</span> <span class="st">&quot;$decade&quot;</span>}<span class="op">,</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgRating</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="st">&quot;_id.decade&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;count&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>}}</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Find the most prolific directors</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">directors</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span>}}}<span class="op">,</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$directors&quot;</span>}<span class="op">,</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$directors&quot;</span><span class="op">,</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">movieCount</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgRating</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}<span class="op">,</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">movies</span><span class="op">:</span> {<span class="dt">$push</span><span class="op">:</span> <span class="st">&quot;$title&quot;</span>}</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">movieCount</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">5</span>}}}<span class="op">,</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="dt">movieCount</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>}}<span class="op">,</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$limit</span><span class="op">:</span> <span class="dv">10</span>}</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co">// Complex analysis: Best genres by decade with minimum movie threshold</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">genres</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span> </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">1980</span>}<span class="op">,</span> </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span>}</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$addFields</span><span class="op">:</span> {</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">decade</span><span class="op">:</span> {<span class="dt">$multiply</span><span class="op">:</span> [{<span class="dt">$floor</span><span class="op">:</span> {<span class="dt">$divide</span><span class="op">:</span> [<span class="st">&quot;$year&quot;</span><span class="op">,</span> <span class="dv">10</span>]}}<span class="op">,</span> <span class="dv">10</span>]}</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$genres&quot;</span>}<span class="op">,</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> {<span class="dt">genre</span><span class="op">:</span> <span class="st">&quot;$genres&quot;</span><span class="op">,</span> <span class="dt">decade</span><span class="op">:</span> <span class="st">&quot;$decade&quot;</span>}<span class="op">,</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgRating</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}<span class="op">,</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>        <span class="dt">maxRating</span><span class="op">:</span> {<span class="dt">$max</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}<span class="op">,</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>        <span class="dt">minRating</span><span class="op">:</span> {<span class="dt">$min</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">count</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">10</span>}}}<span class="op">,</span>  <span class="co">// Only genres with at least 10 movies</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="st">&quot;_id.decade&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;avgRating&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>}}</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<p><strong>Lab 3.5: Working with Sales Data Analytics</strong></p>
<p>The sample_supplies database contains sales transaction data perfect
for business analytics scenarios. These exercises simulate real-world
business intelligence requirements.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>use sample_supplies</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Analyze sales performance by customer demographics</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">sales</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> {</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">gender</span><span class="op">:</span> <span class="st">&quot;$customer.gender&quot;</span><span class="op">,</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">age</span><span class="op">:</span> {<span class="dt">$multiply</span><span class="op">:</span> [{<span class="dt">$floor</span><span class="op">:</span> {<span class="dt">$divide</span><span class="op">:</span> [<span class="st">&quot;$customer.age&quot;</span><span class="op">,</span> <span class="dv">10</span>]}}<span class="op">,</span> <span class="dv">10</span>]}</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalSales</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalRevenue</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$total&quot;</span>}<span class="op">,</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgOrderValue</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$total&quot;</span>}</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="st">&quot;_id.age&quot;</span><span class="op">:</span> <span class="dv">1</span>}}</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Product performance analysis</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">sales</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$items&quot;</span>}<span class="op">,</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$items.name&quot;</span><span class="op">,</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalSold</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$items.quantity&quot;</span>}<span class="op">,</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalRevenue</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> {<span class="dt">$multiply</span><span class="op">:</span> [<span class="st">&quot;$items.quantity&quot;</span><span class="op">,</span> <span class="st">&quot;$items.price&quot;</span>]}}<span class="op">,</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgPrice</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$items.price&quot;</span>}</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="dt">totalRevenue</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>}}<span class="op">,</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$limit</span><span class="op">:</span> <span class="dv">10</span>}</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Time-based sales analysis</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">sales</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$addFields</span><span class="op">:</span> {</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">month</span><span class="op">:</span> {<span class="dt">$month</span><span class="op">:</span> <span class="st">&quot;$saleDate&quot;</span>}<span class="op">,</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> {<span class="dt">$year</span><span class="op">:</span> <span class="st">&quot;$saleDate&quot;</span>}<span class="op">,</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dayOfWeek</span><span class="op">:</span> {<span class="dt">$dayOfWeek</span><span class="op">:</span> <span class="st">&quot;$saleDate&quot;</span>}</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> {<span class="dt">year</span><span class="op">:</span> <span class="st">&quot;$year&quot;</span><span class="op">,</span> <span class="dt">month</span><span class="op">:</span> <span class="st">&quot;$month&quot;</span>}<span class="op">,</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalSales</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalRevenue</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="st">&quot;$total&quot;</span>}<span class="op">,</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgDailyOrders</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="dv">1</span>}</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="st">&quot;_id.year&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;_id.month&quot;</span><span class="op">:</span> <span class="dv">1</span>}}</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<h3 id="text-search-and-indexing">Text Search and Indexing</h3>
<p><strong>Lab 3.6: Implementing Text Search</strong></p>
<p>Modern applications require sophisticated search capabilities.
MongoDB’s text search features provide full-text indexing and search
functionality similar to dedicated search engines.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a text index on multiple fields</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">createIndex</span>({</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;text&quot;</span><span class="op">,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">plot</span><span class="op">:</span> <span class="st">&quot;text&quot;</span><span class="op">,</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fullplot</span><span class="op">:</span> <span class="st">&quot;text&quot;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Perform text search queries</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">$text</span><span class="op">:</span> {<span class="dt">$search</span><span class="op">:</span> <span class="st">&quot;love story&quot;</span>}})</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Text search with specific phrases</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({<span class="dt">$text</span><span class="op">:</span> {<span class="dt">$search</span><span class="op">:</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">space exploration</span><span class="sc">\&quot;</span><span class="st">&quot;</span>}})</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Combine text search with other criteria</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">$text</span><span class="op">:</span> {<span class="dt">$search</span><span class="op">:</span> <span class="st">&quot;war drama&quot;</span>}<span class="op">,</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span>}</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Text search with relevance scoring</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$text</span><span class="op">:</span> {<span class="dt">$search</span><span class="op">:</span> <span class="st">&quot;comedy romance&quot;</span>}}<span class="op">,</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">score</span><span class="op">:</span> {<span class="dt">$meta</span><span class="op">:</span> <span class="st">&quot;textScore&quot;</span>}}</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>)<span class="op">.</span><span class="fu">sort</span>({<span class="dt">score</span><span class="op">:</span> {<span class="dt">$meta</span><span class="op">:</span> <span class="st">&quot;textScore&quot;</span>}})</span></code></pre></div>
<hr />
<h2 id="session-4-schema-design-and-data-modeling">Session 4: Schema
Design and Data Modeling</h2>
<h3 id="document-design-principles">Document Design Principles</h3>
<p><strong>Theoretical Framework: Embedding vs. Referencing</strong></p>
<p>The decision between embedding related data within documents versus
storing references to separate documents fundamentally impacts your
application’s performance and scalability. This choice requires
understanding your application’s access patterns and growth
expectations.</p>
<p><strong>When to Embed Data:</strong> Embed related information when
you typically access it together with the parent document, when the
embedded data has a clear ownership relationship, and when the embedded
data won’t grow unbounded. Consider a blog post with its comments - if
you always display comments with posts and posts have reasonable comment
limits, embedding makes sense.</p>
<p><strong>When to Use References:</strong> Reference separate documents
when the related data is accessed independently, when it’s shared
between multiple parents, or when it could grow to unlimited size. User
profiles referenced by multiple collections (posts, comments, orders)
should remain separate documents.</p>
<p><strong>Lab 4.1: Design Pattern Analysis</strong></p>
<p>Let’s examine real-world design patterns in our sample databases and
understand the reasoning behind each choice.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Examine the user-comment relationship</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">comments</span><span class="op">.</span><span class="fu">findOne</span>()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Notice how comments reference both movies and users</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">// This allows comments to be queried independently</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">// and prevents duplication of user information</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Compare with movie-genre relationship</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">findOne</span>({<span class="dt">genres</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span>}})</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Genres are embedded as arrays because:</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. They&#39;re always displayed with movies</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. The list is bounded (movies rarely have &gt;10 genres)</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Genre names are simple strings, not complex objects</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Examine the theater data structure</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">theaters</span><span class="op">.</span><span class="fu">findOne</span>()</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Notice the deeply embedded location and address data</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">// This makes sense because location data is tightly coupled</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">// with the theater and isn&#39;t shared with other entities</span></span></code></pre></div>
<p><strong>Design Exercise</strong>: Consider how you would model a
university system with students, courses, enrollments, and grades. Work
through the relationships and decide what should be embedded versus
referenced. Consider these questions: - Should student contact
information be embedded in student documents? - How would you handle the
many-to-many relationship between students and courses? - Where should
grade information be stored?</p>
<h3 id="practical-schema-design-lab">Practical Schema Design Lab</h3>
<p><strong>Lab 4.2: Building a Social Media Schema</strong></p>
<p>We’ll design and implement a social media application schema that
demonstrates various design patterns and trade-offs. This exercise
showcases real-world decision-making in document design.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>use social_media_app</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// User profile with embedded personal information</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">users</span><span class="op">.</span><span class="fu">insertOne</span>({</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="fu">ObjectId</span>()<span class="op">,</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">username</span><span class="op">:</span> <span class="st">&quot;tech_enthusiast&quot;</span><span class="op">,</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="op">,</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">profile</span><span class="op">:</span> {</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">firstName</span><span class="op">:</span> <span class="st">&quot;Alex&quot;</span><span class="op">,</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">lastName</span><span class="op">:</span> <span class="st">&quot;Developer&quot;</span><span class="op">,</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bio</span><span class="op">:</span> <span class="st">&quot;Passionate about technology and coding&quot;</span><span class="op">,</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">location</span><span class="op">:</span> {</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">city</span><span class="op">:</span> <span class="st">&quot;San Francisco&quot;</span><span class="op">,</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">state</span><span class="op">:</span> <span class="st">&quot;CA&quot;</span><span class="op">,</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">country</span><span class="op">:</span> <span class="st">&quot;USA&quot;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">joinDate</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">isPrivate</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">stats</span><span class="op">:</span> {</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">postsCount</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">followersCount</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">followingCount</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Posts with embedded comments (bounded) but referenced users</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">posts</span><span class="op">.</span><span class="fu">insertOne</span>({</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="fu">ObjectId</span>()<span class="op">,</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">authorId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;...&quot;</span>)<span class="op">,</span>  <span class="co">// Reference to user</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;Just learned about MongoDB aggregation pipelines!&quot;</span><span class="op">,</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createdAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tags</span><span class="op">:</span> [<span class="st">&quot;mongodb&quot;</span><span class="op">,</span> <span class="st">&quot;database&quot;</span><span class="op">,</span> <span class="st">&quot;learning&quot;</span>]<span class="op">,</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">likes</span><span class="op">:</span> {</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">userIds</span><span class="op">:</span> []  <span class="co">// Array of user IDs who liked this post</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">comments</span><span class="op">:</span> [  <span class="co">// Embedded comments for quick display</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            <span class="dt">_id</span><span class="op">:</span> <span class="fu">ObjectId</span>()<span class="op">,</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>            <span class="dt">authorId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;...&quot;</span>)<span class="op">,</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;Great topic! I&#39;m learning it too.&quot;</span><span class="op">,</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            <span class="dt">createdAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">likes</span><span class="op">:</span> <span class="dv">2</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">visibility</span><span class="op">:</span> <span class="st">&quot;public&quot;</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="co">// Follower relationships as separate documents for flexibility</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">follows</span><span class="op">.</span><span class="fu">insertOne</span>({</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="fu">ObjectId</span>()<span class="op">,</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">followerId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;...&quot;</span>)<span class="op">,</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">followeeId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;...&quot;</span>)<span class="op">,</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">followedAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">status</span><span class="op">:</span> <span class="st">&quot;active&quot;</span>  <span class="co">// Could be: active, pending, blocked</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Lab 4.3: Schema Evolution Simulation</strong></p>
<p>Real applications evolve over time, requiring schema changes. Let’s
simulate how our social media schema adapts to new requirements.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Requirement: Add support for post reactions beyond simple likes</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">posts</span><span class="op">.</span><span class="fu">updateMany</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    {}<span class="op">,</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$rename</span><span class="op">:</span> {<span class="st">&quot;likes&quot;</span><span class="op">:</span> <span class="st">&quot;reactions&quot;</span>}<span class="op">,</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$set</span><span class="op">:</span> {</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;reactions.breakdown&quot;</span><span class="op">:</span> {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                <span class="dt">like</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                <span class="dt">love</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                <span class="dt">laugh</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">angry</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                <span class="dt">sad</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Requirement: Add user verification status</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">users</span><span class="op">.</span><span class="fu">updateMany</span>(</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    {}<span class="op">,</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">$set</span><span class="op">:</span> {</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;profile.verified&quot;</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;profile.verificationDate&quot;</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Requirement: Support for rich media posts</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">posts</span><span class="op">.</span><span class="fu">insertOne</span>({</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">authorId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;...&quot;</span>)<span class="op">,</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;Check out this amazing sunset!&quot;</span><span class="op">,</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createdAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">media</span><span class="op">:</span> [  <span class="co">// Array supports multiple images/videos</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;image&quot;</span><span class="op">,</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>            <span class="dt">url</span><span class="op">:</span> <span class="st">&quot;https://example.com/sunset.jpg&quot;</span><span class="op">,</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>            <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;https://example.com/sunset_thumb.jpg&quot;</span><span class="op">,</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>            <span class="dt">alt</span><span class="op">:</span> <span class="st">&quot;Beautiful sunset over the mountains&quot;</span><span class="op">,</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>            <span class="dt">uploadedAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">location</span><span class="op">:</span> {  <span class="co">// Optional location tagging</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Golden Gate Park&quot;</span><span class="op">,</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        <span class="dt">coordinates</span><span class="op">:</span> {</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>            <span class="dt">latitude</span><span class="op">:</span> <span class="fl">37.7694</span><span class="op">,</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>            <span class="dt">longitude</span><span class="op">:</span> <span class="op">-</span><span class="fl">122.4862</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reactions</span><span class="op">:</span> {</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>        <span class="dt">userIds</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>        <span class="dt">breakdown</span><span class="op">:</span> {<span class="dt">like</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">love</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">laugh</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">angry</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">sad</span><span class="op">:</span> <span class="dv">0</span>}</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    <span class="dt">comments</span><span class="op">:</span> []</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Critical Thinking Exercise</strong>: Analyze the trade-offs
in our social media schema design. Consider these scenarios: 1. A post
goes viral and receives 100,000 comments - how does this affect our
embedded comment strategy? 2. A user wants to see all their reactions
across all posts - how efficient is our current design? 3. We need to
implement real-time notifications for new followers - what queries would
this require?</p>
<p>Discuss alternative approaches and their implications for
performance, consistency, and development complexity.</p>
<hr />
<h2
id="session-5-application-integration---building-with-react-and-python">Session
5: Application Integration - Building with React and Python</h2>
<h3 id="react-integration-deep-dive">React Integration Deep Dive</h3>
<p><strong>Lab 5.1: Setting Up a MERN Stack Movie Browser</strong></p>
<p>We’ll build a complete movie browsing application that demonstrates
professional MongoDB integration patterns. This project showcases
real-world development practices and common architectural decisions.</p>
<p><strong>Backend Setup with Express and Mongoose:</strong></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// models/Movie.js - Mongoose schema definition</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;mongoose&#39;</span>)<span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> movieSchema <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">index</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">Number</span><span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">1800</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getFullYear</span>() <span class="op">+</span> <span class="dv">5</span> }<span class="op">,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">genres</span><span class="op">:</span> [{ <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">enum</span><span class="op">:</span> [<span class="st">&#39;Action&#39;</span><span class="op">,</span> <span class="st">&#39;Comedy&#39;</span><span class="op">,</span> <span class="st">&#39;Drama&#39;</span><span class="op">,</span> <span class="st">&#39;Horror&#39;</span><span class="op">,</span> <span class="st">&#39;Romance&#39;</span><span class="op">,</span> <span class="st">&#39;Sci-Fi&#39;</span><span class="op">,</span> <span class="st">&#39;Thriller&#39;</span>] }]<span class="op">,</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cast</span><span class="op">:</span> [<span class="bu">String</span>]<span class="op">,</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">directors</span><span class="op">:</span> [<span class="bu">String</span>]<span class="op">,</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">plot</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">runtime</span><span class="op">:</span> <span class="bu">Number</span><span class="op">,</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">imdb</span><span class="op">:</span> {</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rating</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">Number</span><span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">10</span> }<span class="op">,</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">votes</span><span class="op">:</span> <span class="bu">Number</span><span class="op">,</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="bu">String</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poster</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">released</span><span class="op">:</span> <span class="bu">Date</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> { </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">timestamps</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">collection</span><span class="op">:</span> <span class="st">&#39;movies&#39;</span>  <span class="co">// Use existing sample data</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Create text index for search functionality</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>movieSchema<span class="op">.</span><span class="fu">index</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;text&#39;</span><span class="op">,</span> <span class="dt">plot</span><span class="op">:</span> <span class="st">&#39;text&#39;</span> })<span class="op">;</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> mongoose<span class="op">.</span><span class="fu">model</span>(<span class="st">&#39;Movie&#39;</span><span class="op">,</span> movieSchema)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// routes/movies.js - RESTful API endpoints</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> Movie <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;../models/Movie&#39;</span>)<span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> router <span class="op">=</span> express<span class="op">.</span><span class="fu">Router</span>()<span class="op">;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">// GET /api/movies - List movies with filtering, sorting, and pagination</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>            page <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>            limit <span class="op">=</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>            genre<span class="op">,</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>            year<span class="op">,</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>            search<span class="op">,</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>            sortBy <span class="op">=</span> <span class="st">&#39;year&#39;</span><span class="op">,</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>            sortOrder <span class="op">=</span> <span class="st">&#39;desc&#39;</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        } <span class="op">=</span> req<span class="op">.</span><span class="at">query</span><span class="op">;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Build query object dynamically</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> query <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (genre) query<span class="op">.</span><span class="at">genres</span> <span class="op">=</span> genre<span class="op">;</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (year) query<span class="op">.</span><span class="at">year</span> <span class="op">=</span> <span class="pp">parseInt</span>(year)<span class="op">;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (search) query<span class="op">.</span><span class="at">$text</span> <span class="op">=</span> { <span class="dt">$search</span><span class="op">:</span> search }<span class="op">;</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Build sort object</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> sort <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        sort[sortBy] <span class="op">=</span> sortOrder <span class="op">===</span> <span class="st">&#39;desc&#39;</span> <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Execute query with pagination</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> movies <span class="op">=</span> <span class="cf">await</span> Movie<span class="op">.</span><span class="fu">find</span>(query)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">sort</span>(sort)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">limit</span>(limit <span class="op">*</span> <span class="dv">1</span>)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">skip</span>((page <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> limit)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;title year genres imdb.rating poster runtime&#39;</span>)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">exec</span>()<span class="op">;</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get total count for pagination</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> total <span class="op">=</span> <span class="cf">await</span> Movie<span class="op">.</span><span class="fu">countDocuments</span>(query)<span class="op">;</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>            movies<span class="op">,</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>            <span class="dt">totalPages</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(total <span class="op">/</span> limit)<span class="op">,</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">currentPage</span><span class="op">:</span> page<span class="op">,</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>            total</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Movie fetch error:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Server error while fetching movies&#39;</span> })<span class="op">;</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="co">// GET /api/movies/:id - Get single movie with full details</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/:id&#39;</span><span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> movie <span class="op">=</span> <span class="cf">await</span> Movie<span class="op">.</span><span class="fu">findById</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>movie) {</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">404</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Movie not found&#39;</span> })<span class="op">;</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">json</span>(movie)<span class="op">;</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Movie detail error:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Server error while fetching movie details&#39;</span> })<span class="op">;</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="co">// GET /api/movies/stats/genres - Aggregate genre statistics</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/stats/genres&#39;</span><span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> genreStats <span class="op">=</span> <span class="cf">await</span> Movie<span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$unwind</span><span class="op">:</span> <span class="st">&#39;$genres&#39;</span> }<span class="op">,</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>                <span class="dt">_id</span><span class="op">:</span> <span class="st">&#39;$genres&#39;</span><span class="op">,</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>                <span class="dt">count</span><span class="op">:</span> { <span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>                <span class="dt">avgRating</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&#39;$imdb.rating&#39;</span> }<span class="op">,</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>                <span class="dt">avgRuntime</span><span class="op">:</span> { <span class="dt">$avg</span><span class="op">:</span> <span class="st">&#39;$runtime&#39;</span> }</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>            }}<span class="op">,</span></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">$sort</span><span class="op">:</span> { <span class="dt">count</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span> } }</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>        ])<span class="op">;</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">json</span>(genreStats)<span class="op">;</span></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Genre stats error:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Server error while calculating genre statistics&#39;</span> })<span class="op">;</span></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> router<span class="op">;</span></span></code></pre></div>
<p><strong>Frontend React Implementation:</strong></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// services/movieService.js - API communication layer</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> API_BASE <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">REACT_APP_API_URL</span> <span class="op">||</span> <span class="st">&#39;http://localhost:5000/api&#39;</span><span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MovieService {</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="kw">async</span> <span class="fu">getMovies</span>(params <span class="op">=</span> {}) {</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> searchParams <span class="op">=</span> <span class="kw">new</span> <span class="fu">URLSearchParams</span>(params)<span class="op">;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`</span><span class="sc">${</span>API_BASE<span class="sc">}</span><span class="vs">/movies?</span><span class="sc">${</span>searchParams<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Failed to fetch movies&#39;</span>)<span class="op">;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="kw">async</span> <span class="fu">getMovieById</span>(id) {</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`</span><span class="sc">${</span>API_BASE<span class="sc">}</span><span class="vs">/movies/</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (response<span class="op">.</span><span class="at">status</span> <span class="op">===</span> <span class="dv">404</span>) {</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Movie not found&#39;</span>)<span class="op">;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Failed to fetch movie details&#39;</span>)<span class="op">;</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="kw">async</span> <span class="fu">getGenreStats</span>() {</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`</span><span class="sc">${</span>API_BASE<span class="sc">}</span><span class="vs">/movies/stats/genres`</span>)<span class="op">;</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Failed to fetch genre statistics&#39;</span>)<span class="op">;</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> MovieService<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre
class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/MovieBrowser.jsx - Main movie browsing component</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> React<span class="op">,</span> { useState<span class="op">,</span> useEffect<span class="op">,</span> useCallback } <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> MovieService <span class="im">from</span> <span class="st">&#39;../services/movieService&#39;</span><span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MovieBrowser <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [movies<span class="op">,</span> setMovies] <span class="op">=</span> <span class="fu">useState</span>([])<span class="op">;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [loading<span class="op">,</span> setLoading] <span class="op">=</span> <span class="fu">useState</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [error<span class="op">,</span> setError] <span class="op">=</span> <span class="fu">useState</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [filters<span class="op">,</span> setFilters] <span class="op">=</span> <span class="fu">useState</span>({</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">genre</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">search</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sortBy</span><span class="op">:</span> <span class="st">&#39;year&#39;</span><span class="op">,</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sortOrder</span><span class="op">:</span> <span class="st">&#39;desc&#39;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [pagination<span class="op">,</span> setPagination] <span class="op">=</span> <span class="fu">useState</span>({</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">currentPage</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalPages</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Fetch movies with current filters</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fetchMovies <span class="op">=</span> <span class="fu">useCallback</span>(<span class="kw">async</span> (page <span class="op">=</span> <span class="dv">1</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setLoading</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setError</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> params <span class="op">=</span> {</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">...</span>filters<span class="op">,</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>                page<span class="op">,</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>                <span class="dt">limit</span><span class="op">:</span> <span class="dv">20</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>            }<span class="op">;</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Remove empty filter values</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(params)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (<span class="op">!</span>params[key]) <span class="kw">delete</span> params[key]<span class="op">;</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> MovieService<span class="op">.</span><span class="fu">getMovies</span>(params)<span class="op">;</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">setMovies</span>(data<span class="op">.</span><span class="at">movies</span>)<span class="op">;</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">setPagination</span>({</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>                <span class="dt">currentPage</span><span class="op">:</span> data<span class="op">.</span><span class="at">currentPage</span><span class="op">,</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>                <span class="dt">totalPages</span><span class="op">:</span> data<span class="op">.</span><span class="at">totalPages</span><span class="op">,</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>                <span class="dt">total</span><span class="op">:</span> data<span class="op">.</span><span class="at">total</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (err) {</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">setError</span>(err<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">finally</span> {</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">setLoading</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> [filters])<span class="op">;</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Effect for initial load and filter changes</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fetchMovies</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> [fetchMovies])<span class="op">;</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle filter changes</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> handleFilterChange <span class="op">=</span> (filterName<span class="op">,</span> value) <span class="kw">=&gt;</span> {</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setFilters</span>(prev <span class="kw">=&gt;</span> ({</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span>prev<span class="op">,</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>            [filterName]<span class="op">:</span> value</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>        }))<span class="op">;</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle pagination</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> handlePageChange <span class="op">=</span> (newPage) <span class="kw">=&gt;</span> {</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fetchMovies</span>(newPage)<span class="op">;</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="ot">className</span><span class="op">=</span><span class="st">&quot;movie-browser&quot;</span><span class="kw">&gt;</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;div</span> <span class="ot">className</span><span class="op">=</span><span class="st">&quot;filters&quot;</span><span class="kw">&gt;</span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&lt;input</span></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">type</span><span class="op">=</span><span class="st">&quot;text&quot;</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">placeholder</span><span class="op">=</span><span class="st">&quot;Search movies...&quot;</span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">value</span><span class="op">=</span><span class="va">{</span>filters<span class="op">.</span><span class="at">search</span><span class="va">}</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">onChange</span><span class="op">=</span><span class="va">{</span>(e) <span class="kw">=&gt;</span> <span class="fu">handleFilterChange</span>(<span class="st">&#39;search&#39;</span><span class="op">,</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)<span class="va">}</span></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>                <span class="kw">/&gt;</span></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&lt;select</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">value</span><span class="op">=</span><span class="va">{</span>filters<span class="op">.</span><span class="at">genre</span><span class="va">}</span></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">onChange</span><span class="op">=</span><span class="va">{</span>(e) <span class="kw">=&gt;</span> <span class="fu">handleFilterChange</span>(<span class="st">&#39;genre&#39;</span><span class="op">,</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)<span class="va">}</span></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&gt;</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;&quot;</span><span class="kw">&gt;</span>All Genres<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;Action&quot;</span><span class="kw">&gt;</span>Action<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;Comedy&quot;</span><span class="kw">&gt;</span>Comedy<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;Drama&quot;</span><span class="kw">&gt;</span>Drama<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;Horror&quot;</span><span class="kw">&gt;</span>Horror<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;Romance&quot;</span><span class="kw">&gt;</span>Romance<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;Sci-Fi&quot;</span><span class="kw">&gt;</span>Sci-Fi<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&lt;/select&gt;</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&lt;select</span></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">value</span><span class="op">=</span><span class="va">{</span>filters<span class="op">.</span><span class="at">sortBy</span><span class="va">}</span></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">onChange</span><span class="op">=</span><span class="va">{</span>(e) <span class="kw">=&gt;</span> <span class="fu">handleFilterChange</span>(<span class="st">&#39;sortBy&#39;</span><span class="op">,</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)<span class="va">}</span></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&gt;</span></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;year&quot;</span><span class="kw">&gt;</span>Year<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;title&quot;</span><span class="kw">&gt;</span>Title<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;imdb.rating&quot;</span><span class="kw">&gt;</span>Rating<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">&lt;option</span> <span class="ot">value</span><span class="op">=</span><span class="st">&quot;runtime&quot;</span><span class="kw">&gt;</span>Runtime<span class="kw">&lt;/option&gt;</span></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>                <span class="kw">&lt;/select&gt;</span></span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;/div&gt;</span></span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>            <span class="va">{</span>loading <span class="op">&amp;&amp; </span><span class="kw">&lt;div</span> <span class="ot">className</span><span class="op">=</span><span class="st">&quot;loading&quot;</span><span class="kw">&gt;</span>Loading movies...<span class="kw">&lt;/div&gt;</span><span class="va">}</span></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>            <span class="va">{</span>error <span class="op">&amp;&amp; </span><span class="kw">&lt;div</span> <span class="ot">className</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="kw">&gt;</span>Error: <span class="va">{</span>error<span class="va">}</span><span class="kw">&lt;/div&gt;</span><span class="va">}</span></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;div</span> <span class="ot">className</span><span class="op">=</span><span class="st">&quot;movie-grid&quot;</span><span class="kw">&gt;</span></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>                <span class="va">{</span>movies<span class="op">.</span><span class="fu">map</span>(movie <span class="kw">=&gt;</span> (</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">&lt;MovieCard</span> <span class="ot">key</span><span class="op">=</span><span class="va">{</span>movie<span class="op">.</span><span class="at">_id</span><span class="va">}</span> <span class="ot">movie</span><span class="op">=</span><span class="va">{</span>movie<span class="va">}</span> <span class="fu">/&gt;</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>                ))<span class="va">}</span></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;/div&gt;</span></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a>            <span class="fu">&lt;Pagination</span></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>                <span class="ot">currentPage</span><span class="op">=</span><span class="va">{</span>pagination<span class="op">.</span><span class="at">currentPage</span><span class="va">}</span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>                <span class="ot">totalPages</span><span class="op">=</span><span class="va">{</span>pagination<span class="op">.</span><span class="at">totalPages</span><span class="va">}</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a>                <span class="ot">onPageChange</span><span class="op">=</span><span class="va">{</span>handlePageChange<span class="va">}</span></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a>            <span class="fu">/&gt;</span></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> MovieBrowser<span class="op">;</span></span></code></pre></div>
<h3 id="python-integration-and-data-analysis">Python Integration and
Data Analysis</h3>
<p><strong>Lab 5.2: Building a Movie Analytics Dashboard with
Flask</strong></p>
<p>Python excels at data analysis and visualization. We’ll create a
Flask application that provides movie analytics using MongoDB’s
aggregation framework.</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># app.py - Flask application with MongoDB analytics</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Flask, jsonify, render_template, request</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pymongo <span class="im">import</span> MongoClient</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bson <span class="im">import</span> json_util</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># MongoDB connection</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> MongoClient(<span class="st">&#39;mongodb://localhost:27017/&#39;</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">&#39;sample_mflix&#39;</span>]</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>movies_collection <span class="op">=</span> db[<span class="st">&#39;movies&#39;</span>]</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MovieAnalytics:</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, collection):</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.collection <span class="op">=</span> collection</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_genre_trends_by_decade(<span class="va">self</span>):</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Analyze genre popularity trends across decades&quot;&quot;&quot;</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        pipeline <span class="op">=</span> [</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$match&#39;</span>: {</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;year&#39;</span>: {<span class="st">&#39;$gte&#39;</span>: <span class="dv">1950</span>, <span class="st">&#39;$lte&#39;</span>: <span class="dv">2020</span>},</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;genres&#39;</span>: {<span class="st">&#39;$exists&#39;</span>: <span class="va">True</span>, <span class="st">&#39;$ne&#39;</span>: []}</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$addFields&#39;</span>: {</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;decade&#39;</span>: {<span class="st">&#39;$multiply&#39;</span>: [{<span class="st">&#39;$floor&#39;</span>: {<span class="st">&#39;$divide&#39;</span>: [<span class="st">&#39;$year&#39;</span>, <span class="dv">10</span>]}}, <span class="dv">10</span>]}</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$unwind&#39;</span>: <span class="st">&#39;$genres&#39;</span>},</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$group&#39;</span>: {</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;_id&#39;</span>: {</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;decade&#39;</span>: <span class="st">&#39;$decade&#39;</span>,</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;genre&#39;</span>: <span class="st">&#39;$genres&#39;</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;count&#39;</span>: {<span class="st">&#39;$sum&#39;</span>: <span class="dv">1</span>},</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;avg_rating&#39;</span>: {<span class="st">&#39;$avg&#39;</span>: <span class="st">&#39;$imdb.rating&#39;</span>},</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;avg_runtime&#39;</span>: {<span class="st">&#39;$avg&#39;</span>: <span class="st">&#39;$runtime&#39;</span>}</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$match&#39;</span>: {<span class="st">&#39;count&#39;</span>: {<span class="st">&#39;$gte&#39;</span>: <span class="dv">5</span>}}},  <span class="co"># Filter out genres with few movies</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$sort&#39;</span>: {<span class="st">&#39;_id.decade&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;count&#39;</span>: <span class="op">-</span><span class="dv">1</span>}}</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">list</span>(<span class="va">self</span>.collection.aggregate(pipeline))</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_director_performance_analysis(<span class="va">self</span>, min_movies<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Analyze director performance metrics&quot;&quot;&quot;</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>        pipeline <span class="op">=</span> [</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$match&#39;</span>: {</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;directors&#39;</span>: {<span class="st">&#39;$exists&#39;</span>: <span class="va">True</span>, <span class="st">&#39;$ne&#39;</span>: []},</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;imdb.rating&#39;</span>: {<span class="st">&#39;$exists&#39;</span>: <span class="va">True</span>}</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$unwind&#39;</span>: <span class="st">&#39;$directors&#39;</span>},</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$group&#39;</span>: {</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;_id&#39;</span>: <span class="st">&#39;$directors&#39;</span>,</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;movie_count&#39;</span>: {<span class="st">&#39;$sum&#39;</span>: <span class="dv">1</span>},</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;avg_rating&#39;</span>: {<span class="st">&#39;$avg&#39;</span>: <span class="st">&#39;$imdb.rating&#39;</span>},</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;total_runtime&#39;</span>: {<span class="st">&#39;$sum&#39;</span>: <span class="st">&#39;$runtime&#39;</span>},</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;genres&#39;</span>: {<span class="st">&#39;$addToSet&#39;</span>: <span class="st">&#39;$genres&#39;</span>},</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;years_active&#39;</span>: {</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;$push&#39;</span>: <span class="st">&#39;$year&#39;</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;highest_rated_movie&#39;</span>: {</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;$max&#39;</span>: {</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;rating&#39;</span>: <span class="st">&#39;$imdb.rating&#39;</span>,</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;title&#39;</span>: <span class="st">&#39;$title&#39;</span>,</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&#39;year&#39;</span>: <span class="st">&#39;$year&#39;</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$match&#39;</span>: {<span class="st">&#39;movie_count&#39;</span>: {<span class="st">&#39;$gte&#39;</span>: min_movies}}},</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$addFields&#39;</span>: {</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;avg_runtime_per_movie&#39;</span>: {<span class="st">&#39;$divide&#39;</span>: [<span class="st">&#39;$total_runtime&#39;</span>, <span class="st">&#39;$movie_count&#39;</span>]},</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;career_span&#39;</span>: {</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;$subtract&#39;</span>: [</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>                        {<span class="st">&#39;$max&#39;</span>: <span class="st">&#39;$years_active&#39;</span>},</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>                        {<span class="st">&#39;$min&#39;</span>: <span class="st">&#39;$years_active&#39;</span>}</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>                    ]</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$sort&#39;</span>: {<span class="st">&#39;avg_rating&#39;</span>: <span class="op">-</span><span class="dv">1</span>}},</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$limit&#39;</span>: <span class="dv">50</span>}</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">list</span>(<span class="va">self</span>.collection.aggregate(pipeline))</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_rating_distribution_analysis(<span class="va">self</span>):</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Analyze movie rating distributions&quot;&quot;&quot;</span></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>        pipeline <span class="op">=</span> [</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$match&#39;</span>: {<span class="st">&#39;imdb.rating&#39;</span>: {<span class="st">&#39;$exists&#39;</span>: <span class="va">True</span>}}},</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$addFields&#39;</span>: {</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;rating_bucket&#39;</span>: {</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;$multiply&#39;</span>: [</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>                        {<span class="st">&#39;$floor&#39;</span>: {<span class="st">&#39;$multiply&#39;</span>: [<span class="st">&#39;$imdb.rating&#39;</span>, <span class="dv">2</span>]}},</span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.5</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>                    ]</span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$group&#39;</span>: {</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;_id&#39;</span>: <span class="st">&#39;$rating_bucket&#39;</span>,</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;count&#39;</span>: {<span class="st">&#39;$sum&#39;</span>: <span class="dv">1</span>},</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;avg_votes&#39;</span>: {<span class="st">&#39;$avg&#39;</span>: <span class="st">&#39;$imdb.votes&#39;</span>},</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;sample_titles&#39;</span>: {<span class="st">&#39;$push&#39;</span>: {<span class="st">&#39;title&#39;</span>: <span class="st">&#39;$title&#39;</span>, <span class="st">&#39;year&#39;</span>: <span class="st">&#39;$year&#39;</span>}}</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$addFields&#39;</span>: {</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;sample_titles&#39;</span>: {<span class="st">&#39;$slice&#39;</span>: [<span class="st">&#39;$sample_titles&#39;</span>, <span class="dv">3</span>]}</span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>            }},</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;$sort&#39;</span>: {<span class="st">&#39;_id&#39;</span>: <span class="dv">1</span>}}</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">list</span>(<span class="va">self</span>.collection.aggregate(pipeline))</span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize analytics engine</span></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a>analytics <span class="op">=</span> MovieAnalytics(movies_collection)</span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/analytics/genre-trends&#39;</span>)</span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> genre_trends():</span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Endpoint for genre trend data&quot;&quot;&quot;</span></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a>        trends <span class="op">=</span> analytics.get_genre_trends_by_decade()</span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json.loads(json_util.dumps(trends))</span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="bu">str</span>(e)}), <span class="dv">500</span></span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/analytics/director-performance&#39;</span>)</span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> director_performance():</span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Endpoint for director performance metrics&quot;&quot;&quot;</span></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a>        min_movies <span class="op">=</span> <span class="bu">int</span>(request.args.get(<span class="st">&#39;min_movies&#39;</span>, <span class="dv">3</span>))</span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true" tabindex="-1"></a>        performance <span class="op">=</span> analytics.get_director_performance_analysis(min_movies)</span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json.loads(json_util.dumps(performance))</span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="bu">str</span>(e)}), <span class="dv">500</span></span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/analytics/rating-distribution&#39;</span>)</span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rating_distribution():</span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Endpoint for rating distribution analysis&quot;&quot;&quot;</span></span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true" tabindex="-1"></a>        distribution <span class="op">=</span> analytics.get_rating_distribution_analysis()</span>
<span id="cb28-140"><a href="#cb28-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json.loads(json_util.dumps(distribution))</span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb28-142"><a href="#cb28-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="bu">str</span>(e)}), <span class="dv">500</span></span>
<span id="cb28-143"><a href="#cb28-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb28-145"><a href="#cb28-145" aria-hidden="true" tabindex="-1"></a>    app.run(debug<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<p><strong>Lab 5.3: Data Science with MongoDB and Pandas</strong></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analytics_notebook.py - Jupyter notebook-style analysis</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pymongo <span class="im">import</span> MongoClient</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to MongoDB</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> MongoClient(<span class="st">&#39;mongodb://localhost:27017/&#39;</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">&#39;sample_mflix&#39;</span>]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_movies_dataframe():</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Convert MongoDB movie data to pandas DataFrame for analysis&quot;&quot;&quot;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> [</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&#39;$match&#39;</span>: {</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;year&#39;</span>: {<span class="st">&#39;$gte&#39;</span>: <span class="dv">1990</span>, <span class="st">&#39;$lte&#39;</span>: <span class="dv">2020</span>},</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;imdb.rating&#39;</span>: {<span class="st">&#39;$exists&#39;</span>: <span class="va">True</span>},</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;genres&#39;</span>: {<span class="st">&#39;$exists&#39;</span>: <span class="va">True</span>, <span class="st">&#39;$ne&#39;</span>: []}</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        }},</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        {<span class="st">&#39;$project&#39;</span>: {</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;title&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;year&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;genres&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;runtime&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;rating&#39;</span>: <span class="st">&#39;$imdb.rating&#39;</span>,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;votes&#39;</span>: <span class="st">&#39;$imdb.votes&#39;</span>,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;directors&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;cast&#39;</span>: <span class="dv">1</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        }}</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    movies_cursor <span class="op">=</span> db.movies.aggregate(pipeline)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    movies_list <span class="op">=</span> <span class="bu">list</span>(movies_cursor)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to DataFrame</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.json_normalize(movies_list)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data cleaning and preprocessing</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&#39;runtime&#39;</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">&#39;runtime&#39;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&#39;votes&#39;</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">&#39;votes&#39;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&#39;rating&#39;</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">&#39;rating&#39;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add decade column</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&#39;decade&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;year&#39;</span>] <span class="op">//</span> <span class="dv">10</span>) <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_genre_performance(df):</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Analyze performance metrics by genre&quot;&quot;&quot;</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Explode genres to create one row per genre</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    genre_df <span class="op">=</span> df.explode(<span class="st">&#39;genres&#39;</span>)</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate genre statistics</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    genre_stats <span class="op">=</span> genre_df.groupby(<span class="st">&#39;genres&#39;</span>).agg({</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;rating&#39;</span>: [<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;std&#39;</span>, <span class="st">&#39;count&#39;</span>],</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;runtime&#39;</span>: <span class="st">&#39;mean&#39;</span>,</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;votes&#39;</span>: <span class="st">&#39;mean&#39;</span>,</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;year&#39;</span>: [<span class="st">&#39;min&#39;</span>, <span class="st">&#39;max&#39;</span>]</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    }).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten column names</span></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>    genre_stats.columns <span class="op">=</span> [<span class="st">&#39;_&#39;</span>.join(col).strip() <span class="cf">for</span> col <span class="kw">in</span> genre_stats.columns]</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter genres with sufficient data</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>    genre_stats <span class="op">=</span> genre_stats[genre_stats[<span class="st">&#39;rating_count&#39;</span>] <span class="op">&gt;=</span> <span class="dv">20</span>]</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> genre_stats.sort_values(<span class="st">&#39;rating_mean&#39;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> visualize_trends(df):</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create visualizations for movie trends&quot;&quot;&quot;</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Subplot 1: Movies per year</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>    yearly_counts <span class="op">=</span> df.groupby(<span class="st">&#39;year&#39;</span>).size()</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>    plt.plot(yearly_counts.index, yearly_counts.values)</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Number of Movies Released per Year&#39;</span>)</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;Number of Movies&#39;</span>)</span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Subplot 2: Average rating by decade</span></span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>    decade_ratings <span class="op">=</span> df.groupby(<span class="st">&#39;decade&#39;</span>)[<span class="st">&#39;rating&#39;</span>].mean()</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>    plt.bar(decade_ratings.index, decade_ratings.values)</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Average Movie Rating by Decade&#39;</span>)</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Decade&#39;</span>)</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;Average Rating&#39;</span>)</span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Subplot 3: Runtime distribution</span></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>    plt.hist(df[<span class="st">&#39;runtime&#39;</span>].dropna(), bins<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Movie Runtime Distribution&#39;</span>)</span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Runtime (minutes)&#39;</span>)</span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Subplot 4: Rating vs Runtime correlation</span></span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a>    plt.scatter(df[<span class="st">&#39;runtime&#39;</span>], df[<span class="st">&#39;rating&#39;</span>], alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&#39;Rating vs Runtime Correlation&#39;</span>)</span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Runtime (minutes)&#39;</span>)</span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;IMDB Rating&#39;</span>)</span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb29-105"><a href="#cb29-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-106"><a href="#cb29-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute analysis</span></span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Loading movie data from MongoDB...&quot;</span>)</span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a>    movies_df <span class="op">=</span> create_movies_dataframe()</span>
<span id="cb29-110"><a href="#cb29-110" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Loaded </span><span class="sc">{</span><span class="bu">len</span>(movies_df)<span class="sc">}</span><span class="ss"> movies&quot;</span>)</span>
<span id="cb29-111"><a href="#cb29-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-112"><a href="#cb29-112" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Genre Performance Analysis:&quot;</span>)</span>
<span id="cb29-113"><a href="#cb29-113" aria-hidden="true" tabindex="-1"></a>    genre_performance <span class="op">=</span> analyze_genre_performance(movies_df)</span>
<span id="cb29-114"><a href="#cb29-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(genre_performance.head(<span class="dv">10</span>))</span>
<span id="cb29-115"><a href="#cb29-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-116"><a href="#cb29-116" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Generating visualizations...&quot;</span>)</span>
<span id="cb29-117"><a href="#cb29-117" aria-hidden="true" tabindex="-1"></a>    visualize_trends(movies_df)</span></code></pre></div>
<hr />
<h2
id="session-6-performance-optimization-and-production-readiness">Session
6: Performance Optimization and Production Readiness</h2>
<h3 id="indexing-strategies-and-query-optimization">Indexing Strategies
and Query Optimization</h3>
<p><strong>Lab 6.1: Understanding Query Performance</strong></p>
<p>Query optimization begins with understanding how MongoDB executes
queries and where bottlenecks occur. The explain() method provides
detailed insights into query execution plans.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Analyze a slow query without indexes</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span><span class="op">,</span> <span class="dt">$lte</span><span class="op">:</span> <span class="dv">2010</span>}<span class="op">,</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="fl">8.0</span>}</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">explain</span>(<span class="st">&quot;executionStats&quot;</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Look for these key indicators in the output:</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">// - &quot;stage&quot;: &quot;COLLSCAN&quot; indicates a full collection scan</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">// - &quot;executionTimeMillis&quot;: shows query execution time</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">// - &quot;totalDocsExamined&quot;: documents scanned vs &quot;totalDocsReturned&quot;</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">// - High examined-to-returned ratio indicates inefficiency</span></span></code></pre></div>
<p><strong>Lab 6.2: Strategic Index Creation</strong></p>
<p>Effective indexing requires understanding the ESR (Equality, Sort,
Range) principle for compound indexes. Fields used for equality matches
should come first, followed by sort fields, then range query fields.</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create indexes based on common query patterns</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Single field indexes for basic queries</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">createIndex</span>({<span class="dt">year</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">createIndex</span>({<span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Compound index following ESR principle</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">// For queries filtering by genre, sorting by year, and ranging on rating</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">createIndex</span>({</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">genres</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>      <span class="co">// Equality</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span>       <span class="co">// Sort  </span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>  <span class="co">// Range</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Text index for search functionality</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">createIndex</span>({</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;text&quot;</span><span class="op">,</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">plot</span><span class="op">:</span> <span class="st">&quot;text&quot;</span><span class="op">,</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fullplot</span><span class="op">:</span> <span class="st">&quot;text&quot;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> {</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">weights</span><span class="op">:</span> {</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span>      <span class="co">// Title matches are more important</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">plot</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fullplot</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Geospatial index for location queries</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>use sample_restaurants</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">restaurants</span><span class="op">.</span><span class="fu">createIndex</span>({<span class="st">&quot;address.coord&quot;</span><span class="op">:</span> <span class="st">&quot;2dsphere&quot;</span>})</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Partial indexes to reduce index size and improve performance</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">createIndex</span>(</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    {<span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">partialFilterExpression</span><span class="op">:</span> {</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$exists</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">$gte</span><span class="op">:</span> <span class="fl">7.0</span>}</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Lab 6.3: Query Optimization Techniques</strong></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Compare query performance before and after optimization</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Inefficient query - multiple separate conditions</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">$or</span><span class="op">:</span> [</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">year</span><span class="op">:</span> <span class="dv">2000</span>}<span class="op">,</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">year</span><span class="op">:</span> <span class="dv">2001</span>}<span class="op">,</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">year</span><span class="op">:</span> <span class="dv">2002</span>}</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="fl">8.0</span>}</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">explain</span>(<span class="st">&quot;executionStats&quot;</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Optimized query - using $in operator</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span><span class="op">:</span> {<span class="dt">$in</span><span class="op">:</span> [<span class="dv">2000</span><span class="op">,</span> <span class="dv">2001</span><span class="op">,</span> <span class="dv">2002</span>]}<span class="op">,</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="fl">8.0</span>}</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">explain</span>(<span class="st">&quot;executionStats&quot;</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Inefficient pagination with skip()</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>()<span class="op">.</span><span class="fu">sort</span>({<span class="dt">year</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})<span class="op">.</span><span class="fu">skip</span>(<span class="dv">1000</span>)<span class="op">.</span><span class="fu">limit</span>(<span class="dv">20</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Efficient pagination using range queries</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>({</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> {<span class="dt">$lt</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;last_seen_id&quot;</span>)}</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">sort</span>({<span class="dt">_id</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})<span class="op">.</span><span class="fu">limit</span>(<span class="dv">20</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Use projection to limit returned data</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">genres</span><span class="op">:</span> <span class="st">&quot;Action&quot;</span>}<span class="op">,</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">title</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;imdb.rating&quot;</span><span class="op">:</span> <span class="dv">1</span>}  <span class="co">// Only return needed fields</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Optimize aggregation pipelines by placing $match early</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">year</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">2000</span>}}}<span class="op">,</span>        <span class="co">// Filter first</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$genres&quot;</span>}<span class="op">,</span>                   <span class="co">// Then transform</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$genres&quot;</span><span class="op">,</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">avgRating</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> <span class="st">&quot;$imdb.rating&quot;</span>}</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    }}</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<h3 id="security-implementation">Security Implementation</h3>
<p><strong>Lab 6.4: Implementing Authentication and
Authorization</strong></p>
<p>Production MongoDB deployments require proper security configuration.
We’ll implement authentication, authorization, and connection
security.</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create administrative user</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>use admin</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">createUser</span>({</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">user</span><span class="op">:</span> <span class="st">&quot;dbAdmin&quot;</span><span class="op">,</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pwd</span><span class="op">:</span> <span class="st">&quot;secureAdminPassword123!&quot;</span><span class="op">,</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">roles</span><span class="op">:</span> [</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;userAdminAnyDatabase&quot;</span><span class="op">,</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;dbAdminAnyDatabase&quot;</span><span class="op">,</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;readWriteAnyDatabase&quot;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Create application-specific users with limited permissions</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">createUser</span>({</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">user</span><span class="op">:</span> <span class="st">&quot;movieAppUser&quot;</span><span class="op">,</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pwd</span><span class="op">:</span> <span class="st">&quot;appUserPassword456!&quot;</span><span class="op">,</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">roles</span><span class="op">:</span> [</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">role</span><span class="op">:</span> <span class="st">&quot;readWrite&quot;</span><span class="op">,</span> <span class="dt">db</span><span class="op">:</span> <span class="st">&quot;sample_mflix&quot;</span>}<span class="op">,</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">role</span><span class="op">:</span> <span class="st">&quot;read&quot;</span><span class="op">,</span> <span class="dt">db</span><span class="op">:</span> <span class="st">&quot;sample_analytics&quot;</span>}</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Create read-only user for reporting</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">createUser</span>({</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">user</span><span class="op">:</span> <span class="st">&quot;reportingUser&quot;</span><span class="op">,</span> </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pwd</span><span class="op">:</span> <span class="st">&quot;reportingPassword789!&quot;</span><span class="op">,</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">roles</span><span class="op">:</span> [</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">role</span><span class="op">:</span> <span class="st">&quot;read&quot;</span><span class="op">,</span> <span class="dt">db</span><span class="op">:</span> <span class="st">&quot;sample_mflix&quot;</span>}<span class="op">,</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">role</span><span class="op">:</span> <span class="st">&quot;read&quot;</span><span class="op">,</span> <span class="dt">db</span><span class="op">:</span> <span class="st">&quot;sample_restaurants&quot;</span>}<span class="op">,</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>        {<span class="dt">role</span><span class="op">:</span> <span class="st">&quot;read&quot;</span><span class="op">,</span> <span class="dt">db</span><span class="op">:</span> <span class="st">&quot;sample_supplies&quot;</span>}</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Application Security Best Practices:</strong></p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Production connection string with authentication</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> connectionString <span class="op">=</span> <span class="vs">`mongodb://</span><span class="sc">${</span>username<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span>password<span class="sc">}</span><span class="vs">@localhost:27017/</span><span class="sc">${</span>database<span class="sc">}</span><span class="vs">?authSource=admin&amp;ssl=true`</span><span class="op">;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Input validation and sanitization</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">validateMovieQuery</span>(queryParams) {</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> allowedFields <span class="op">=</span> [<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;year&#39;</span><span class="op">,</span> <span class="st">&#39;genre&#39;</span><span class="op">,</span> <span class="st">&#39;rating&#39;</span>]<span class="op">;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> allowedOperators <span class="op">=</span> [<span class="st">&#39;$gte&#39;</span><span class="op">,</span> <span class="st">&#39;$lte&#39;</span><span class="op">,</span> <span class="st">&#39;$in&#39;</span><span class="op">,</span> <span class="st">&#39;$regex&#39;</span>]<span class="op">;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sanitize and validate input</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sanitizedQuery <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> [field<span class="op">,</span> value] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(queryParams)) {</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (allowedFields<span class="op">.</span><span class="fu">includes</span>(field)) {</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>            sanitizedQuery[field] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sanitizedQuery<span class="op">;</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Rate limiting implementation</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rateLimit <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express-rate-limit&#39;</span>)<span class="op">;</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> apiLimiter <span class="op">=</span> <span class="fu">rateLimit</span>({</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">windowMs</span><span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">max</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="co">// Limit each IP to 100 requests per windowMs</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Too many requests from this IP&#39;</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/&#39;</span><span class="op">,</span> apiLimiter)<span class="op">;</span></span></code></pre></div>
<h3 id="monitoring-and-maintenance">Monitoring and Maintenance</h3>
<p><strong>Lab 6.5: Performance Monitoring Setup</strong></p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Monitor database performance metrics</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">runCommand</span>({<span class="dt">serverStatus</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Check current operations</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">currentOp</span>()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Monitor slow queries (set profiling level)</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">setProfilingLevel</span>(<span class="dv">2</span><span class="op">,</span> {<span class="dt">slowms</span><span class="op">:</span> <span class="dv">100</span>})</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Analyze profiling data</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">system</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="fu">find</span>()<span class="op">.</span><span class="fu">sort</span>({<span class="dt">ts</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span>})<span class="op">.</span><span class="fu">limit</span>(<span class="dv">10</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Monitor index usage</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$indexStats</span><span class="op">:</span> {}}</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Check collection statistics</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">stats</span>()</span></code></pre></div>
<p><strong>Maintenance Scripts:</strong></p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Database maintenance aggregation</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>use sample_mflix</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Find and remove duplicate movies (by title and year)</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> duplicateMovies <span class="op">=</span> db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&quot;$title&quot;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="st">&quot;$year&quot;</span>}<span class="op">,</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">count</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ids</span><span class="op">:</span> {<span class="dt">$push</span><span class="op">:</span> <span class="st">&quot;$_id&quot;</span>}</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">count</span><span class="op">:</span> {<span class="dt">$gt</span><span class="op">:</span> <span class="dv">1</span>}}}</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Clean up old profiling data</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">system</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="fu">deleteMany</span>({</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ts</span><span class="op">:</span> {<span class="dt">$lt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">-</span> <span class="dv">7</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span>)}</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Reindex collections for optimal performance</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">movies</span><span class="op">.</span><span class="fu">reIndex</span>()<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="final-project-and-assessment">Final Project and Assessment</h2>
<h3 id="capstone-project-movie-recommendation-system">Capstone Project:
Movie Recommendation System</h3>
<p><strong>Project Requirements:</strong> Students will build a complete
movie recommendation system that demonstrates all learned MongoDB
concepts.</p>
<p><strong>Technical Specifications:</strong> 1. <strong>Database
Design</strong>: Create collections for users, movies, ratings, and
recommendations 2. <strong>CRUD Operations</strong>: Implement user
registration, movie rating, and recommendation viewing 3.
<strong>Advanced Queries</strong>: Use aggregation pipelines to
calculate movie similarities and user preferences 4.
<strong>Performance</strong>: Implement appropriate indexes and query
optimization 5. <strong>Integration</strong>: Choose either React
frontend or Python analytics dashboard</p>
<p><strong>Lab 6.6: Recommendation System Implementation</strong></p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">// User rating schema</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>use movie_recommender</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">users</span><span class="op">.</span><span class="fu">insertOne</span>({</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_id</span><span class="op">:</span> <span class="fu">ObjectId</span>()<span class="op">,</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">username</span><span class="op">:</span> <span class="st">&quot;movie_lover_123&quot;</span><span class="op">,</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="op">,</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">preferences</span><span class="op">:</span> {</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">favoriteGenres</span><span class="op">:</span> [<span class="st">&quot;Sci-Fi&quot;</span><span class="op">,</span> <span class="st">&quot;Drama&quot;</span>]<span class="op">,</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dislikedGenres</span><span class="op">:</span> [<span class="st">&quot;Horror&quot;</span>]<span class="op">,</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">preferredDecades</span><span class="op">:</span> [<span class="dv">2000</span><span class="op">,</span> <span class="dv">2010</span>]</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">joinDate</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">ratings</span><span class="op">.</span><span class="fu">insertMany</span>([</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">userId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;...&quot;</span>)<span class="op">,</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">movieId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;...&quot;</span>)<span class="op">,</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rating</span><span class="op">:</span> <span class="fl">4.5</span><span class="op">,</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">review</span><span class="op">:</span> <span class="st">&quot;Amazing cinematography and storytelling&quot;</span><span class="op">,</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ratedAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Recommendation algorithm using aggregation</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="at">ratings</span><span class="op">.</span><span class="fu">aggregate</span>([</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find users with similar taste</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">userId</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;current_user_id&quot;</span>)}}<span class="op">,</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$lookup</span><span class="op">:</span> {</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">from</span><span class="op">:</span> <span class="st">&quot;ratings&quot;</span><span class="op">,</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        <span class="dt">let</span><span class="op">:</span> {<span class="dt">userMovies</span><span class="op">:</span> <span class="st">&quot;$movieId&quot;</span>}<span class="op">,</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pipeline</span><span class="op">:</span> [</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>            {<span class="dt">$match</span><span class="op">:</span> {</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>                <span class="dt">$expr</span><span class="op">:</span> {<span class="dt">$eq</span><span class="op">:</span> [<span class="st">&quot;$movieId&quot;</span><span class="op">,</span> <span class="st">&quot;$$userMovies&quot;</span>]}<span class="op">,</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>                <span class="dt">userId</span><span class="op">:</span> {<span class="dt">$ne</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;current_user_id&quot;</span>)}</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>            }}</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">as</span><span class="op">:</span> <span class="st">&quot;similarRatings&quot;</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate user similarity and generate recommendations</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$unwind</span><span class="op">:</span> <span class="st">&quot;$similarRatings&quot;</span>}<span class="op">,</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$group</span><span class="op">:</span> {</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_id</span><span class="op">:</span> <span class="st">&quot;$similarRatings.userId&quot;</span><span class="op">,</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>        <span class="dt">similarity</span><span class="op">:</span> {<span class="dt">$avg</span><span class="op">:</span> {<span class="dt">$abs</span><span class="op">:</span> {<span class="dt">$subtract</span><span class="op">:</span> [<span class="st">&quot;$rating&quot;</span><span class="op">,</span> <span class="st">&quot;$similarRatings.rating&quot;</span>]}}}<span class="op">,</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sharedMovies</span><span class="op">:</span> {<span class="dt">$sum</span><span class="op">:</span> <span class="dv">1</span>}</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    }}<span class="op">,</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$match</span><span class="op">:</span> {<span class="dt">sharedMovies</span><span class="op">:</span> {<span class="dt">$gte</span><span class="op">:</span> <span class="dv">3</span>}}}<span class="op">,</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$sort</span><span class="op">:</span> {<span class="dt">similarity</span><span class="op">:</span> <span class="dv">1</span>}}<span class="op">,</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">$limit</span><span class="op">:</span> <span class="dv">10</span>}</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<p><strong>Assessment Criteria:</strong> - <strong>Database Design
(25%)</strong>: Appropriate schema choices, normalization decisions -
<strong>Query Efficiency (25%)</strong>: Proper use of indexes,
optimized aggregation pipelines - <strong>Feature Completeness
(25%)</strong>: All CRUD operations, search functionality,
recommendations - <strong>Code Quality (25%)</strong>: Error handling,
security considerations, documentation</p>
<p><strong>Presentation Guidelines:</strong> Students present their
solutions explaining design decisions, demonstrating functionality, and
discussing performance optimizations. This reinforces learning through
teaching and provides peer learning opportunities.</p>
<hr />
<h2 id="course-conclusion-and-next-steps">Course Conclusion and Next
Steps</h2>
<h3 id="key-takeaways">Key Takeaways</h3>
<p>This intensive course provided hands-on experience with MongoDB’s
core concepts, from basic document operations to complex aggregation
pipelines and production deployment considerations. Students learned to
make informed decisions about when to use NoSQL databases and how to
design efficient, scalable document schemas.</p>
<h3 id="continuing-education-path">Continuing Education Path</h3>
<ol type="1">
<li><strong>Advanced Topics</strong>: Explore MongoDB replica sets,
sharding, and change streams for production scalability</li>
<li><strong>Specialized Use Cases</strong>: Study time-series data,
full-text search with Atlas Search, and mobile synchronization</li>
<li><strong>Cloud Deployment</strong>: Master MongoDB Atlas advanced
features, monitoring, and backup strategies</li>
<li><strong>Integration Patterns</strong>: Learn microservices
architecture with MongoDB, event-driven design, and data pipeline
construction</li>
</ol>
<h3 id="resources-for-further-learning">Resources for Further
Learning</h3>
<ul>
<li>MongoDB University free courses for certification</li>
<li>Official MongoDB documentation and best practices guides<br />
</li>
<li>Community forums and MongoDB user groups</li>
<li>Advanced aggregation framework patterns and optimization
techniques</li>
</ul>
<p>The skills developed in this course provide a solid foundation for
building modern, scalable applications that leverage MongoDB’s
flexibility and performance capabilities.</p>
